<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrueChats Themes</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    
    <style>
        /* --- THEME VARIABLES --- */
        :root {
            /* Default (Emerald) */
            --primary: #00a884; --bg-grad: linear-gradient(135deg, #008069, #00a884);
            --chat-bg: #efeae2; --sent: #d9fdd3; --sent-text: #111; --received: #fff;
            --white: #fff; --text: #111;
        }

        /* Ocean Blue */
        body.theme-ocean {
            --primary: #0084ff; --bg-grad: linear-gradient(135deg, #00c6ff, #0072ff);
            --chat-bg: #f0f8ff; --sent: #0084ff; --sent-text: #fff; --received: #fff;
        }

        /* Midnight Purple */
        body.theme-midnight {
            --primary: #8e44ad; --bg-grad: linear-gradient(135deg, #8e44ad, #3498db);
            --chat-bg: #2c3e50; --sent: #9b59b6; --sent-text: #fff; --received: #34495e; 
            --white: #1a1a1a; --text: #eee;
        }

        /* Sunset Orange */
        body.theme-sunset {
            --primary: #ff7e5f; --bg-grad: linear-gradient(135deg, #ff7e5f, #feb47b);
            --chat-bg: #fff5ee; --sent: #ff7e5f; --sent-text: #fff; --received: #fff;
        }

        /* Dark Mode */
        body.theme-dark {
            --primary: #00a884; --bg-grad: #111b21;
            --chat-bg: #0b141a; --sent: #005c4b; --sent-text: #e9edef; --received: #202c33;
            --white: #111b21; --text: #e9edef;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        body { height: 100vh; overflow: hidden; background: #d1d7db; transition: 0.3s; }
        .hidden { display: none !important; } .center { display: flex; justify-content: center; align-items: center; }

        /* AUTH SCREEN */
        #auth-screen { position: fixed; width: 100%; height: 100%; background: var(--bg-grad); z-index: 2000; flex-direction: column; }
        .card { background: rgba(255,255,255,0.9); padding: 40px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); backdrop-filter: blur(10px); }
        body.theme-midnight .card { background: rgba(0,0,0,0.8); color: white; }
        input { width: 100%; padding: 15px; margin-bottom: 15px; border: none; background: #f0f2f5; border-radius: 10px; outline: none; }
        .btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-bottom: 10px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }

        /* APP LAYOUT */
        #app-screen { display: flex; height: 100%; background: var(--white); color: var(--text); }
        .sidebar { width: 350px; display: flex; flex-direction: column; border-right: 1px solid rgba(0,0,0,0.1); }
        
        .header { padding: 15px; background: var(--bg-grad); display: flex; align-items: center; justify-content: space-between; color: white; }
        .my-dp { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid white; cursor: pointer; }
        
        .tabs { display: flex; background: rgba(0,0,0,0.05); padding: 5px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; color: #888; border-radius: 5px; }
        .tab-btn.active { background: var(--primary); color: white; }

        .list-area { flex: 1; overflow-y: auto; padding: 10px; }
        .item { display: flex; align-items: center; padding: 12px; margin-bottom: 5px; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .item:hover { background: rgba(0,0,0,0.05); }
        .item img { width: 45px; height: 45px; border-radius: 50%; margin-right: 15px; object-fit: cover; }

        /* CHAT AREA */
        .chat-area { flex: 1; display: flex; flex-direction: column; background: var(--chat-bg); position: relative; }
        .chat-area::before { content: ""; position: absolute; width: 100%; height: 100%; opacity: 0.08; background-image: url("https://www.transparenttextures.com/patterns/cubes.png"); pointer-events: none; }

        .chat-header { background: var(--bg-grad); padding: 10px 15px; display: flex; align-items: center; height: 65px; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .chat-header img { width: 40px; height: 40px; border-radius: 50%; margin: 0 10px; object-fit: cover; border: 2px solid white; }
        
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; z-index: 1; }
        .msg { max-width: 75%; padding: 8px 14px; border-radius: 14px; font-size: 14px; position: relative; word-wrap: break-word; box-shadow: 0 1px 2px rgba(0,0,0,0.1); animation: popIn 0.3s ease; }
        .sent { align-self: flex-end; background: var(--sent); color: var(--sent-text); border-bottom-right-radius: 0; }
        .received { align-self: flex-start; background: var(--received); color: #111; border-bottom-left-radius: 0; }
        
        .tick { font-size: 11px; margin-left: 5px; }
        .tick.seen { color: #34b7f1; } /* Blue Ticks */
        .tick.delivered { color: #999; } /* Grey Ticks */

        .input-bar { padding: 10px; background: var(--white); display: flex; align-items: center; gap: 10px; }
        .input-bar input { flex: 1; padding: 12px 20px; background: rgba(0,0,0,0.05); border: none; border-radius: 30px; outline: none; color: var(--text); }

        /* CALL OVERLAY */
        #call-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 5000; flex-direction: column; color: white; }
        #call-avatar { width: 130px; height: 130px; border-radius: 50%; border: 4px solid rgba(255,255,255,0.2); margin-bottom: 20px; animation: pulse 1.5s infinite; }
        .c-btn { width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 24px; cursor: pointer; display: flex; justify-content: center; align-items: center; color: white; transition: 0.3s; }
        .bg-red { background: #ff4757; } .bg-green { background: #2ecc71; } .bg-grey { background: #334155; }
        .c-btn.active { background: white; color: black; }

        /* THEME MODAL */
        #theme-modal { position: absolute; top: 60px; left: 10px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 100; width: 220px; }
        .theme-opt { display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 5px; color: #333; }
        .theme-opt:hover { background: #eee; }
        .color-dot { width: 20px; height: 20px; border-radius: 50%; margin-right: 10px; }

        /* ANIMATIONS */
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.4); } 70% { box-shadow: 0 0 0 25px rgba(0,0,0,0); } }

        /* MOBILE */
        @media (max-width: 768px) {
            .sidebar { width: 100%; height: 100%; }
            .chat-area { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; transform: translateX(100%); transition: 0.3s; }
            .chat-area.active { transform: translateX(0); }
            .back-btn { display: block; }
        }
    </style>
</head>
<body>

    <div id="call-screen" class="center hidden">
        <img id="call-avatar" src="">
        <h2 id="call-user">User</h2>
        <p id="call-status">Calling...</p>
        
        <div id="inc-btns" class="hidden center" style="gap:30px; margin-top:50px;">
            <button class="c-btn bg-red" onclick="rejectCall()"><i class="fa fa-phone-slash"></i></button>
            <button class="c-btn bg-green" onclick="answerCall()"><i class="fa fa-phone"></i></button>
        </div>
        
        <div id="ong-btns" class="center hidden" style="gap:20px; margin-top:50px;">
            <button class="c-btn bg-grey" id="speaker-btn" onclick="toggleSpeaker()"><i class="fa fa-volume-up"></i></button>
            <button class="c-btn bg-grey" onclick="toggleMute()"><i class="fa fa-microphone"></i></button>
            <button class="c-btn bg-red" onclick="endCall()"><i class="fa fa-phone-slash"></i></button>
        </div>
        <p style="margin-top:20px; font-size:12px; color:#aaa;">(Tap Speaker to toggle Audio Output)</p>
    </div>

    <div id="app-screen" class="hidden">
        <div class="sidebar">
            <div class="header">
                <div class="center" style="gap:10px;">
                    <img id="my-dp" class="my-dp" src="" onclick="changeDP()">
                    <div>
                        <h3 id="my-name" onclick="changeName()" style="cursor:pointer; border-bottom:1px dotted white;">Me <i class="fa fa-pencil" style="font-size:10px;"></i></h3>
                        <small style="opacity:0.8">Online</small>
                    </div>
                </div>
                <div class="center" style="gap:15px;">
                    <i class="fa fa-palette" onclick="toggleThemes()" style="cursor:pointer;" title="Themes"></i>
                    <i class="fa fa-power-off" onclick="logout()" style="cursor:pointer;"></i>
                </div>
            </div>

            <div id="theme-modal" class="hidden">
                <div class="theme-opt" onclick="setTheme('default')"><div class="color-dot" style="background:#00a884"></div>Emerald (Default)</div>
                <div class="theme-opt" onclick="setTheme('ocean')"><div class="color-dot" style="background:#0084ff"></div>Ocean Blue</div>
                <div class="theme-opt" onclick="setTheme('midnight')"><div class="color-dot" style="background:#8e44ad"></div>Midnight Purple</div>
                <div class="theme-opt" onclick="setTheme('sunset')"><div class="color-dot" style="background:#ff7e5f"></div>Sunset Orange</div>
                <div class="theme-opt" onclick="setTheme('dark')"><div class="color-dot" style="background:#111"></div>Dark Mode</div>
            </div>

            <div class="tabs">
                <button onclick="switchTab('friends', this)" class="tab-btn active">Chats</button>
                <button onclick="switchTab('search', this)" class="tab-btn">Search</button>
                <button onclick="switchTab('requests', this)" class="tab-btn">Requests <span id="req-cnt">0</span></button>
                </div>

            <div id="tab-friends" class="list-area">Loading...</div>
            <div id="tab-search" class="list-area hidden"><input type="text" placeholder="Search..." onkeyup="searchUsers(this)" style="width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;"><div id="search-res"></div></div>
            <div id="tab-requests" class="list-area hidden"></div>
        </div>

        <div id="chat-area" class="chat-area">
            <div id="chat-header" class="chat-header hidden">
                <i class="fa fa-arrow-left back-btn" onclick="closeChat()"></i>
                <img id="chat-img" src="">
                <h3 id="chat-name" style="flex:1; margin-left:10px; font-size:16px;">User</h3>
                <i class="fa fa-phone" onclick="startCallUI()" style="font-size:20px; cursor:pointer;"></i>
            </div>
            
            <div id="messages"></div>

            <div id="input-bar" class="input-bar hidden">
                <input type="text" id="msg-input" placeholder="Message...">
                <button onclick="sendMessage()" style="width:40px; height:40px; border-radius:50%; background:var(--primary); color:white; border:none;"><i class="fa fa-paper-plane"></i></button>
            </div>
            
            <div id="empty-state" class="center" style="height:100%; flex-direction:column; color:#999;">
                <i class="fa fa-comments" style="font-size:60px; margin-bottom:15px; opacity:0.5"></i>
                <p>Select a chat</p>
            </div>
        </div>
    </div>

    <div id="auth-screen" class="center">
        <div class="card">
            <h1>TrueChats ðŸŽ¨</h1>
            <p>Ultimate Theme Edition</p>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button onclick="login()" class="btn">Login</button>
            <button onclick="register()" class="btn" style="background:#555;">Register</button>
        </div>
    </div>

    <audio id="remote-audio" autoplay></audio>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp, updateDoc, doc, setDoc, getDoc, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        const config={apiKey:"AIzaSyCAsCm1YcsAjHwyvIzxyMrBmZPLw2hlo18",authDomain:"truechats-8dac9.firebaseapp.com",projectId:"truechats-8dac9",storageBucket:"truechats-8dac9.firebasestorage.app",messagingSenderId:"685374771914",appId:"1:685374771914:web:81bf491264c1bb09061a33"};
        const app=initializeApp(config); const auth=getAuth(app); const db=getFirestore(app); const storage=getStorage(app);

        let currentUser, currentChatUser, chatId, peer, activeCall, localStream;
        const getAvatar=(u)=>u.photoURL||`https://ui-avatars.com/api/?name=${u.displayName}&background=random&color=fff`;

        // AUTH & THEME
        onAuthStateChanged(auth, async(u)=>{
            if(u){
                currentUser=u;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-screen').classList.remove('hidden');
                document.getElementById('my-name').innerText = u.displayName;
                document.getElementById('my-dp').src = getAvatar(u);
                await setDoc(doc(db,"users",u.uid),{uid:u.uid,email:u.email.toLowerCase(),displayName:u.displayName,photoURL:u.photoURL},{merge:true});
                initPeer(u.uid); loadFriends(); loadRequests();
                
                // Load saved theme
                const savedTheme = localStorage.getItem('chatTheme');
                if(savedTheme) document.body.className = savedTheme;
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-screen').classList.add('hidden');
            }
        });

        // THEMES
        window.toggleThemes = () => document.getElementById('theme-modal').classList.toggle('hidden');
        window.setTheme = (themeName) => {
            document.body.className = `theme-${themeName}`;
            localStorage.setItem('chatTheme', `theme-${themeName}`);
            document.getElementById('theme-modal').classList.add('hidden');
        };

        // NICKNAME
        window.changeName = async () => {
            const newName = prompt("Enter your Nickname:", currentUser.displayName);
            if(newName && newName.trim() !== "") {
                await updateProfile(currentUser, { displayName: newName });
                await updateDoc(doc(db, "users", currentUser.uid), { displayName: newName });
                document.getElementById('my-name').innerText = newName;
                alert("Nickname Updated!");
            }
        };

        // CHAT & TICKS
        window.openChat = (u) => {
            currentChatUser=u;
            chatId = currentUser.uid < u.uid ? `${currentUser.uid}_${u.uid}` : `${u.uid}_${currentUser.uid}`;
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('chat-header').classList.remove('hidden');
            document.getElementById('input-bar').classList.remove('hidden');
            document.getElementById('chat-name').innerText = u.displayName;
            document.getElementById('chat-img').src = getAvatar(u);
            document.querySelector('.chat-area').classList.add('active');
            loadMessages();
        };

        window.sendMessage = async() => {
            const txt = document.getElementById('msg-input').value.trim();
            if(!txt) return;
            await addDoc(collection(db,"messages"),{
                text: txt, sender: currentUser.uid, chatId: chatId, 
                createdAt: serverTimestamp(), viewed: false, delivered: false 
            });
            document.getElementById('msg-input').value = "";
        };

        function loadMessages() {
            const box = document.getElementById('messages');
            const q = query(collection(db,"messages"),where("chatId","==",chatId),orderBy("createdAt","asc"));
            onSnapshot(q,(snap)=>{
                box.innerHTML="";
                snap.forEach(d=>{
                    const data=d.data();
                    const isMe = data.sender === currentUser.uid;
                    
                    // Mark as seen if I am receiving
                    if(!isMe && !data.viewed) {
                        updateDoc(doc(db,"messages",d.id), { viewed: true });
                    }

                    const div=document.createElement('div');
                    div.className=`msg ${isMe?'sent':'received'}`;
                    
                    // Tick Logic
                    let ticks = "";
                    if(isMe) {
                        if(data.viewed) ticks = '<i class="fa fa-check-double tick seen"></i>'; // Blue Double
                        else ticks = '<i class="fa fa-check-double tick delivered"></i>'; // Grey Double
                    }

                    const time = data.createdAt ? data.createdAt.toDate().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}) : '...';
                    div.innerHTML = `${data.text} <span style="font-size:10px; float:right; margin-top:5px; opacity:0.7; margin-left:5px;">${time}${ticks}</span>`;
                    box.appendChild(div);
                });
                box.scrollTop=box.scrollHeight;
            });
        }

        // CALLS & SPEAKER TOGGLE
        function initPeer(uid){
            if(peer) return; peer=new Peer(uid);
            peer.on('call',(call)=>{
                activeCall=call; showIncomingUI(call.peer);
                window.answerCall=()=>{
                    navigator.mediaDevices.getUserMedia({audio:true}).then(s=>{
                        localStream=s; call.answer(s);
                        document.getElementById('call-status').innerText="Connected";
                        document.getElementById('inc-btns').classList.add('hidden');
                        document.getElementById('ong-btns').classList.remove('hidden');
                        call.on('stream',r=>{document.getElementById('remote-audio').srcObject=r});
                        call.on('close',closeCallUI);
                    });
                }
                window.rejectCall=()=>{call.close(); closeCallUI();}
            });
        }

        window.startCallUI = async() => {
            document.getElementById('call-screen').classList.remove('hidden');
            document.getElementById('call-avatar').src = getAvatar(currentChatUser);
            document.getElementById('call-user').innerText = currentChatUser.displayName;
            document.getElementById('call-status').innerText = "Calling...";
            document.getElementById('inc-btns').classList.add('hidden');
            document.getElementById('ong-btns').classList.remove('hidden');

            try {
                localStream = await navigator.mediaDevices.getUserMedia({audio:true});
                const call = peer.call(currentChatUser.uid, localStream);
                activeCall = call;
                call.on('stream',r=>{
                    document.getElementById('remote-audio').srcObject=r;
                    document.getElementById('call-status').innerText="Connected";
                });
                call.on('close', closeCallUI);
            } catch(e){ alert("Mic Denied"); closeCallUI(); }
        }

        // SPEAKER TOGGLE LOGIC
        window.toggleSpeaker = async () => {
            const audio = document.getElementById('remote-audio');
            const btn = document.getElementById('speaker-btn');
            
            // Check if browser supports sinkId (Chrome Android does, Safari might not)
            if (audio.setSinkId !== undefined) {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const audioOutputs = devices.filter(device => device.kind === 'audiooutput');
                
                // Toggle between default (earpiece/system default) and speaker
                if (btn.classList.contains('active')) {
                    // Switch to Default (Earpiece logic depends on OS)
                    await audio.setSinkId(""); 
                    btn.classList.remove('active');
                    alert("Switched to Earpiece/Default");
                } else {
                    // Attempt to switch to Speaker (usually the second output or specific ID)
                    // Note: Selecting specific speaker ID is tricky, passing 'speaker' if supported
                    const speaker = audioOutputs.find(d => d.label.toLowerCase().includes('speaker'));
                    if(speaker) {
                         await audio.setSinkId(speaker.deviceId);
                         btn.classList.add('active');
                         alert("Switched to Speaker");
                    } else {
                         alert("Speaker device not found directly. Please use system volume settings.");
                    }
                }
            } else {
                alert("Your browser does not support audio output switching. Please use the device volume buttons or notification shade.");
            }
        };

        window.toggleMute = () => {
            if(localStream) {
                const track = localStream.getAudioTracks()[0];
                track.enabled = !track.enabled;
                alert(track.enabled ? "Unmuted" : "Muted");
            }
        };

        window.endCall = () => { if(activeCall) activeCall.close(); closeCallUI(); }
        
        async function showIncomingUI(id) {
            const u = (await getDoc(doc(db,"users",id))).data();
            document.getElementById('call-screen').classList.remove('hidden');
            document.getElementById('call-avatar').src = getAvatar(u);
            document.getElementById('call-user').innerText = u.displayName;
            document.getElementById('inc-btns').classList.remove('hidden');
            document.getElementById('ong-btns').classList.add('hidden');
        }
        function closeCallUI() {
            document.getElementById('call-screen').classList.add('hidden');
            if(localStream) localStream.getTracks().forEach(t=>t.stop());
        }

        // HELPERS
        window.switchTab=(t,b)=>{
            document.querySelectorAll('.list-area').forEach(e=>e.classList.add('hidden'));
            document.getElementById(`tab-${t}`).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));
            b.classList.add('active');
        }
        window.closeChat = () => document.querySelector('.chat-area').classList.remove('active');
        window.changeDP=()=>{const i=document.createElement('input');i.type='file';i.onchange=async(e)=>{const f=e.target.files[0];if(!f)return;alert("Uploading...");const r=ref(storage,`dp/${currentUser.uid}`);await uploadBytes(r,f);const u=await getDownloadURL(r);await updateProfile(currentUser,{photoURL:u});await updateDoc(doc(db,"users",currentUser.uid),{photoURL:u});document.getElementById('my-dp').src=u;};i.click();}
        window.searchUsers=async(inpt)=>{const v=inpt.value.toLowerCase(); const b=document.getElementById('search-res'); if(v.length<3)return b.innerHTML=""; const q=query(collection(db,"users"),where("email",">=",v),where("email","<=",v+'\uf8ff')); const s=await getDocs(q); b.innerHTML=""; s.forEach(d=>{const u=d.data(); if(u.uid!==currentUser.uid) b.innerHTML+=`<div class="item"><img src="${getAvatar(u)}"><div><b>${u.displayName}</b></div><button onclick="sendReq('${u.uid}')" style="margin-left:auto; padding:5px 10px; background:var(--primary); color:white; border:none; border-radius:5px;">Add</button></div>`})};
        window.sendReq=async(uid)=>{await updateDoc(doc(db,"users",uid),{requests:arrayUnion(currentUser.uid)}); alert("Sent");}
        window.loadRequests=()=>{onSnapshot(doc(db,"users",currentUser.uid),async(s)=>{const b=document.getElementById('tab-requests'); b.innerHTML=""; const r=s.data().requests||[]; document.getElementById('req-cnt').innerText=r.length; for(const id of r){const u=(await getDoc(doc(db,"users",id))).data(); b.innerHTML+=`<div class="item"><img src="${getAvatar(u)}"><div><b>${u.displayName}</b> wants to join</div><button onclick="accReq('${id}')" style="margin-left:auto; padding:5px; background:green; color:white;">Accept</button></div>`}})};
        window.accReq=async(id)=>{await updateDoc(doc(db,"users",currentUser.uid),{requests:arrayRemove(id),friends:arrayUnion(id)}); await updateDoc(doc(db,"users",id),{friends:arrayUnion(currentUser.uid)});}
        window.loadFriends=()=>{onSnapshot(doc(db,"users",currentUser.uid),async(s)=>{const b=document.getElementById('tab-friends'); b.innerHTML=""; const f=s.data().friends||[]; for(const id of f){const u=(await getDoc(doc(db,"users",id))).data(); b.innerHTML+=`<div class="item" onclick="openChat({uid:'${u.uid}',displayName:'${u.displayName}',photoURL:'${u.photoURL}'})"><img src="${getAvatar(u)}"><div><b>${u.displayName}</b><br><small>Tap to chat</small></div></div>`}})};
        window.login=async()=>{try{await signInWithEmailAndPassword(auth,document.getElementById('email').value,document.getElementById('password').value)}catch(e){alert(e.message)}};
        window.register=async()=>{try{const e=document.getElementById('email').value; const c=await createUserWithEmailAndPassword(auth,e,document.getElementById('password').value); await setDoc(doc(db,"users",c.user.uid),{uid:c.user.uid,email:e,displayName:e.split('@')[0],friends:[],requests:[]})}catch(e){alert(e.message)}};
        window.logout=()=>signOut(auth);
        window.forgotPass=()=>{const e=prompt("Email:");if(e)sendPasswordResetEmail(auth,e)};
    </script>
</body>
</html>
