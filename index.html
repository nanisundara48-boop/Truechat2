<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>True Chats - Private & Secure</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body { overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        .love-theme-bg { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #feada6 100%); }
        .premium-theme-bg { background-color: #f3f4f6; }
        .animate-pulse-fast { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }
        .heart-beat { animation: heartBeat 1.5s infinite; }
        /* Scrollbar Hide */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- FIREBASE CONFIG (Your Keys) ---
        const firebaseConfig = {
            apiKey: "AIzaSyCAsCm1YcsAjHwyvIzxyMrBmZPLw2hlo18",
            authDomain: "truechats-8dac9.firebaseapp.com",
            projectId: "truechats-8dac9",
            storageBucket: "truechats-8dac9.appspot.com",
            messagingSenderId: "685374771914",
            appId: "1:685374771914:web:81bf491264c1bb09061a33"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const { useState, useEffect, useRef } = React;

        // --- DUMMY DATA (Simulating Database for Demo) ---
        const MOCK_FRIENDS = [
            { id: '101', name: 'Nani', username: '@nani1248', avatar: null, status: 'online', type: 'general' },
            { id: '102', name: 'My Love', username: '@sweety', avatar: null, status: 'offline', type: 'private' }, 
            { id: '103', name: 'Raju Bhai', username: '@raju', avatar: null, status: 'online', type: 'general' }
        ];

        const FRIEND_REQUESTS = [
            { id: 201, name: 'Varun', mutual: 3 },
            { id: 202, name: 'Priya', mutual: 1 }
        ];

        // --- MAIN APP COMPONENT ---
        function App() {
            const [user, setUser] = useState(null);
            
            // UI State
            const [isLoveTheme, setIsLoveTheme] = useState(false);
            const [currentChat, setCurrentChat] = useState(null);
            const [showRequests, setShowRequests] = useState(false);
            
            // Privacy State
            const [isPrivateMode, setIsPrivateMode] = useState(false);
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [passwordInput, setPasswordInput] = useState("");
            const [privatePassword] = useState("1234"); // Default Password
            
            // Chat State
            const [messages, setMessages] = useState([]);
            const [inputText, setInputText] = useState("");
            const [replyTo, setReplyTo] = useState(null);
            const [editingMsgId, setEditingMsgId] = useState(null);
            const [seenAfterDelete, setSeenAfterDelete] = useState(false);
            const [disappearTimer, setDisappearTimer] = useState(null);

            // Video Call State
            const [isVideoCall, setIsVideoCall] = useState(false);
            const [isMicDenied, setIsMicDenied] = useState(false);

            // Auth Listener
            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (u) => setUser(u));
                return () => unsubscribe();
            }, []);

            // Login
            const handleLogin = async () => {
                try { await signInWithPopup(auth, new GoogleAuthProvider()); } 
                catch (error) { console.error("Login failed", error); }
            };

            // Toggle Private Mode
            const togglePrivateMode = () => {
                if (isPrivateMode) {
                    setIsPrivateMode(false);
                    setCurrentChat(null);
                } else {
                    setShowPasswordModal(true);
                }
            };

            const verifyPassword = () => {
                if (passwordInput === privatePassword) {
                    setIsPrivateMode(true);
                    setShowPasswordModal(false);
                    setPasswordInput("");
                } else {
                    alert("Wrong Password!");
                }
            };

            // Send Message
            const sendMessage = () => {
                if (!inputText.trim()) return;

                if (editingMsgId) {
                    setMessages(prev => prev.map(m => m.id === editingMsgId ? { ...m, text: inputText, isEdited: true } : m));
                    setEditingMsgId(null);
                    setInputText("");
                    return;
                }

                const newMsg = {
                    id: Date.now(),
                    text: inputText,
                    sender: user.uid,
                    timestamp: Date.now(),
                    seen: false,
                    isEdited: false,
                    replyTo: replyTo,
                    seenAfterDelete: seenAfterDelete
                };

                setMessages(prev => [newMsg, ...prev]);
                setInputText("");
                setReplyTo(null);

                // Auto Reply Simulation
                setTimeout(() => {
                    setMessages(prev => [{
                        id: Date.now() + 1, text: "Got it! ❤️", sender: 'other', timestamp: Date.now(), seen: false
                    }, ...prev]);
                }, 1500);
            };

            // Message Actions
            const deleteMessage = (msgId, timestamp) => {
                const diffMins = (Date.now() - timestamp) / 60000;
                if (diffMins > 24 * 60) {
                    setMessages(prev => prev.filter(m => m.id !== msgId)); // Delete for me
                } else {
                    if(confirm("Delete for Everyone?")) setMessages(prev => prev.filter(m => m.id !== msgId));
                }
            };

            const handleEdit = (msg) => {
                const diffMins = (Date.now() - msg.timestamp) / 60000;
                if (diffMins > 20) alert("Edit time expired!");
                else {
                    setInputText(msg.text);
                    setEditingMsgId(msg.id);
                }
            };

            // --- COMPONENTS ---

            const Header = () => (
                <div className={`h-16 flex items-center justify-between px-4 shadow-md z-20 transition-all ${isLoveTheme ? 'bg-pink-600 text-white' : 'bg-white text-gray-800'}`}>
                    <h1 className="text-xl font-bold font-serif">True Chats</h1>
                    <div className="flex items-center gap-4">
                        <div className="relative cursor-pointer" onClick={() => setShowRequests(!showRequests)}>
                            <i className="fas fa-user-friends text-lg"></i>
                            {FRIEND_REQUESTS.length > 0 && <span className="absolute -top-1 -right-2 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">2</span>}
                        </div>
                        <div onClick={() => setIsLoveTheme(!isLoveTheme)} className="cursor-pointer hover:scale-110 transition">
                            {isLoveTheme ? <i className="fas fa-heart text-red-200 text-lg heart-beat"></i> : <i className="far fa-heart text-lg"></i>}
                        </div>
                        <div onClick={togglePrivateMode} className="cursor-pointer">
                            {isPrivateMode ? <i className="fas fa-eye text-red-500 text-lg"></i> : <i className="fas fa-eye-slash text-gray-400 text-lg"></i>}
                        </div>
                        <div className="relative group">
                             <i className="fas fa-clock text-lg cursor-pointer"></i>
                             <div className="absolute right-0 top-8 bg-white shadow-lg rounded p-2 hidden group-hover:block w-32 text-gray-800 text-xs">
                                <div className="hover:bg-gray-100 p-2 cursor-pointer" onClick={() => setDisappearTimer(24)}>Min 24 hrs</div>
                                <div className="hover:bg-gray-100 p-2 cursor-pointer" onClick={() => setDisappearTimer(48)}>Max 48 hrs</div>
                             </div>
                        </div>
                        <div className="relative group cursor-pointer">
                            {user?.photoURL ? <img src={user.photoURL} className="w-8 h-8 rounded-full border-2 border-white" /> : <div className="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center font-bold">U</div>}
                            <div className="absolute right-0 top-10 w-48 bg-white shadow-xl rounded-lg p-3 hidden group-hover:block z-50 text-gray-800 text-sm">
                                <p className="font-bold border-b pb-1">{user?.displayName}</p>
                                <p className="text-xs text-gray-500 mt-1">Friends: 15</p>
                                <button onClick={() => auth.signOut()} className="w-full text-left mt-2 text-red-500 font-bold">Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const Sidebar = () => (
                <div className={`w-full md:w-1/3 border-r flex flex-col ${isLoveTheme ? 'bg-white/80' : 'bg-white'} ${currentChat ? 'hidden md:flex' : 'flex'}`}>
                    <div className="p-3 border-b">
                        <div className="bg-gray-100 rounded-full px-4 py-2 flex items-center">
                            <i className="fas fa-search text-gray-400"></i>
                            <input type="text" placeholder="Search..." className="bg-transparent ml-2 outline-none w-full text-sm"/>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto">
                        {MOCK_FRIENDS.map(f => {
                            if (f.type === 'private' && !isPrivateMode) return null;
                            return (
                                <div key={f.id} onClick={() => setCurrentChat(f)} className="flex items-center p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100">
                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg ${isLoveTheme ? 'bg-pink-500' : 'bg-gray-400'}`}>{f.name.charAt(0)}</div>
                                    <div className="ml-3 flex-1">
                                        <div className="flex justify-between"><h3 className="font-bold text-sm">{f.name} {f.type === 'private' && '❤️'}</h3><span className="text-xs text-gray-400">10:00</span></div>
                                        <p className="text-xs text-gray-500">Tap to chat...</p>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );

            const ChatWindow = () => {
                if (!currentChat) return <div className="hidden md:flex flex-1 items-center justify-center text-gray-400 bg-gray-50">Select a chat</div>;
                const [showMenu, setShowMenu] = useState(false);
                
                return (
                    <div className={`flex-1 flex flex-col h-full relative ${isLoveTheme ? 'bg-pink-50' : 'bg-gray-100'}`}>
                        <div className={`h-16 flex items-center justify-between px-4 shadow-sm ${isLoveTheme ? 'bg-pink-100' : 'bg-white'}`}>
                            <div className="flex items-center cursor-pointer">
                                <i className="fas fa-arrow-left md:hidden mr-3" onClick={() => setCurrentChat(null)}></i>
                                <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${isLoveTheme ? 'bg-pink-500' : 'bg-gray-500'}`}>{currentChat.name.charAt(0)}</div>
                                <div className="ml-3"><h3 className="font-bold text-sm">{currentChat.name}</h3><p className="text-xs text-green-500">Online</p></div>
                            </div>
                            <div className="flex items-center gap-4 text-gray-600">
                                <i className="fas fa-video cursor-pointer" onClick={() => setIsVideoCall(true)}></i>
                                <div className="relative">
                                    <button onClick={() => setShowMenu(!showMenu)} className="font-bold tracking-widest">::::</button>
                                    {showMenu && (
                                        <div className="absolute right-0 top-8 w-48 bg-white shadow-xl rounded z-50 py-1 text-sm animate-pulse-fast">
                                            <div className="px-4 py-2 hover:bg-gray-100">Details</div>
                                            <div className="px-4 py-2 hover:bg-gray-100 text-pink-600 font-bold" onClick={() => alert("Moved to Private!")}>Hide Chat ❤️</div>
                                            <div className="px-4 py-2 hover:bg-gray-100 text-red-500">Block</div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 flex flex-col-reverse space-y-2 space-y-reverse scrollbar-hide">
                            {messages.map((msg) => (
                                <div key={msg.id} className={`flex flex-col max-w-[75%] ${msg.sender === user.uid ? 'self-end items-end' : 'self-start items-start'}`} onDoubleClick={() => setReplyTo(msg)}>
                                    <div className={`px-4 py-2 rounded-lg shadow-sm ${msg.sender === user.uid ? (isLoveTheme ? 'bg-pink-500 text-white' : 'bg-blue-600 text-white') : 'bg-white text-gray-800'}`}>
                                        {msg.replyTo && <div className="text-xs opacity-75 border-l-2 pl-1 mb-1">Reply to: {msg.replyTo.text}</div>}
                                        <p>{msg.text} {msg.isEdited && <span className="text-[9px] opacity-60">(edited)</span>}</p>
                                        <div className="flex justify-end gap-1 mt-1 text-[9px] opacity-70">
                                            <span>10:05</span>
                                            {msg.sender === user.uid && <i className="fas fa-check-double"></i>}
                                        </div>
                                    </div>
                                    {msg.sender === user.uid && (
                                        <div className="flex gap-2 text-[9px] text-gray-400 mt-1">
                                            <button onClick={() => handleEdit(msg)}>Edit</button>
                                            <button onClick={() => deleteMessage(msg.id, msg.timestamp)}>Delete</button>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        <div className={`p-3 flex items-center gap-2 border-t ${isLoveTheme ? 'bg-pink-100' : 'bg-white'}`}>
                            {(isLoveTheme || isPrivateMode) && (
                                <div className="cursor-pointer text-xs text-gray-500" onClick={() => setSeenAfterDelete(!seenAfterDelete)}>
                                    <div className={`w-8 h-4 rounded-full p-0.5 ${seenAfterDelete ? 'bg-pink-500' : 'bg-gray-300'}`}><div className={`w-3 h-3 bg-white rounded-full transition ${seenAfterDelete ? 'translate-x-4' : ''}`}></div></div>
                                </div>
                            )}
                            {replyTo && <div className="text-xs text-blue-500 border-l-2 border-blue-500 pl-2">Replying... <button onClick={() => setReplyTo(null)}>x</button></div>}
                            <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && sendMessage()} placeholder="Type..." className="flex-1 px-4 py-2 rounded-full border outline-none bg-gray-50 text-sm"/>
                            <button onClick={sendMessage} className="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center"><i className="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                );
            };

            const VideoCall = () => (
                <div className="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center text-white">
                    <div className="absolute top-8 left-8"><h2 className="text-2xl font-bold">{currentChat?.name}</h2><p className="animate-pulse">00:23</p></div>
                    <div className="text-center animate-pulse"><img src={currentChat?.avatar || "https://via.placeholder.com/150"} className="w-32 h-32 rounded-full mb-4 mx-auto border-4 border-green-500"/>Calling...</div>
                    <div className="absolute top-8 right-8 w-24 h-36 bg-gray-800 rounded border border-gray-600 flex items-center justify-center text-xs">You</div>
                    <div className="absolute bottom-10 flex gap-6">
                        <button onClick={() => setIsMicDenied(!isMicDenied)} className={`p-4 rounded-full ${isMicDenied ? 'bg-white text-black' : 'bg-gray-700'}`}><i className="fas fa-microphone-slash"></i></button>
                        <button onClick={() => setIsVideoCall(false)} className="p-5 bg-red-600 rounded-full"><i className="fas fa-phone-slash"></i></button>
                    </div>
                    {isMicDenied && <div className="absolute top-1/2 bg-red-500 px-4 py-2 rounded">Mic Denied!</div>}
                </div>
            );

            // --- RENDER LOGIC ---
            if (!user) return (
                <div className="h-screen w-screen flex flex-col items-center justify-center bg-gray-900 text-white">
                    <h1 className="text-5xl font-serif mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-pink-600">True Chats</h1>
                    <button onClick={handleLogin} className="bg-white text-gray-900 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-gray-200 transition"><i className="fab fa-google mr-2"></i> Sign in with Google</button>
                </div>
            );

            return (
                <div className={`h-screen w-screen flex flex-col overflow-hidden ${isLoveTheme ? 'love-theme-bg' : 'premium-theme-bg'}`}>
                    {isVideoCall && <VideoCall />}
                    {showPasswordModal && (
                        <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center">
                            <div className="bg-white p-6 rounded-lg shadow-xl w-72 text-center">
                                <h2 className="text-lg font-bold mb-4">Enter Password ❤️</h2>
                                <input type="password" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} className="w-full border p-2 mb-4 text-center tracking-widest rounded" placeholder="****"/>
                                <button onClick={verifyPassword} className="bg-pink-500 text-white px-4 py-2 rounded w-full">Unlock</button>
                                <button onClick={() => setShowPasswordModal(false)} className="mt-2 text-gray-500 text-xs">Cancel</button>
                            </div>
                        </div>
                    )}
                    <Header />
                    {showRequests && <div className="absolute top-16 right-16 w-64 bg-white shadow-xl rounded p-2 z-50 border">{FRIEND_REQUESTS.map(r => <div key={r.id} className="flex justify-between p-2 border-b"><span>{r.name}</span><button className="text-blue-500 text-xs">Accept</button></div>)}</div>}
                    <div className="flex flex-1 overflow-hidden">
                        <Sidebar />
                        <ChatWindow />
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
